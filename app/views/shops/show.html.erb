<p id="notice"><%= notice %></p>
<h2><%= @shop.name %></h2>
<%= link_to 'Edit', edit_masteragent_agent_subagent_shop_path(@masteragent, @agent, @shop.subagent_id, @shop) %> |
<%= link_to 'Back', masteragent_agent_subagent_shops_path(@masteragent, @agent, @shop.subagent_id) %>






<div style='width: 800px;'>
  <div id="geolocation" style='width: 800px; height: 400px;'></div>
</div>
<button onclick="updateposition()">Confirmer La Position</button>

  <script type="text/javascript">
var plat = 0;
    var handler = Gmaps.build('Google');
handler.buildMap({ internal: {id: 'geolocation'} }, function(){
  // be aware chrome >= 50 requires https for geolocation to work
  if(navigator.geolocation)
    navigator.geolocation.getCurrentPosition(displayOnMap);
});
var plat= "0";
var plng = "0";
function displayOnMap(position){
  var marker = handler.addMarker({
    lat: position.coords.latitude,
    lng: position.coords.longitude


  });

  handler.map.centerOn(marker);
  plat = position.coords.latitude;
  plng = position.coords.longitude;

};

function updateposition(){
  alert("hello"+plat);
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);
  //const product = urlParams.get()
  var pathArray = window.location.pathname;//.split('/');
  alert(pathArray+'/position_update');
  $.ajax({
      url: pathArray+'/position_update',
        type: "POST",
        dataType: "json",
        data: {lat : plat, lng : plng},
        success: function(data) {
            if (data == "OK")
          {alert("hello  url   : ");}
  }})
}
  </script>
